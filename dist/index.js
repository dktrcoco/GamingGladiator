var medalsGold,medalsSilver,medalsBronze,medalsTotal,gamerName=$("#username-input");function pullMedalData(){var a=gamerName.val(),b=a.replace("#","-");$.ajax({url:"/api/gold/"+b,method:"GET"}).then(function(a){let c=0;a&&(c=a.medalsGold||0);$.ajax({url:"https://ow-api.com/v1/stats/pc/us/"+b+"/profile",method:"GET"}).then(function(a){const d=a.quickPlayStats.awards.medalsGold;medalsSilver=a.quickPlayStats.awards.medalsSilver,medalsBronze=a.quickPlayStats.awards.medalsBronze,medalsTotal=a.quickPlayStats.awards.medals,$.ajax({url:"/api/new",method:"POST",data:{gamerName:b,medalsBronze:medalsBronze,medalsSilver:medalsSilver,medalsGold:d,medalsGoldPrevious:c,medalsTotal:medalsTotal}}).then(function(){})})})}async function getGamerData(){let a=await fetch("/api/gamername").then(a=>a.json()),b=a.map(a=>a.gamerName);return b}async function getNewGold(){let a=await getGamerData(),b=[],c=[];for(let b=0;b<a.length;b++){var d="https://ow-api.com/v1/stats/pc/us/"+a[b]+"/profile";c.push($.ajax({url:d,method:"GET"}))}const e=await Promise.all(c);for(let a=0;a<e.length;a++)b.push(e[a].quickPlayStats.awards.medalsGold);return b}async function displayGraph(){let a=await subtractMedals(),b=await getGamerData();var c=document.getElementById("overData").getContext("2d");new Chart(c).Bar({labels:b,datasets:[{fillColor:"#FFFFFF",strokeColor:"#000000",data:a}]})}async function subtractMedals(){let a=await getOldGold(),b=await getNewGold(),c=[];for(let d=0;d<a.length;d++)c.push(b[d]-a[d]);return c}async function getOldGold(){let a=await fetch("/api/oldgold").then(a=>a.json()),b=a.map(a=>a.medalsGold);return b}function resetCompetition(){$.ajax({method:"DELETE",url:"/api/reset"}).then(function(){alert("Competition Reset!!")})}$(".results-button").on("click",function(){displayGraph()}),$(".enter-button").on("click",function(a){a.preventDefault();var b=gamerName.val(),c=b.replace("#","-");pullMedalData();var d=$("<div>"+b+"</div>");if(0<=$("#empty-div").children().length&&$("#empty-div").children()[0]){let a=!0;for(var e=0;e<$("#empty-div").children().length;e++)if(b===$("#empty-div").children()[e].innerHTML){alert("Gamer tag already exists"),a=!1;break}else continue;a&&$("#empty-div").append(d)}else $("#empty-div").append(d)}),$(".reset-button").on("click",function(){resetCompetition()});